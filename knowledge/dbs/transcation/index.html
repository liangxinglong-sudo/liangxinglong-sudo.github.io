<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.20" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><meta property="og:url" content="https://liangxinglong-sudo.github.io/knowledge/dbs/transcation/"><meta property="og:site_name" content="coder liang"><meta property="og:title" content="数据库事务"><meta property="og:description" content="事务的四大特性 事务是必须满足4个条件（ACID）：[A] 原子性 、[C] 一致性 、[I] 隔离性 、[D] 持久性 。 原子性：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。 一致性：在..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="事务"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"数据库事务","image":[""],"dateModified":null,"author":[]}</script><link rel="icon" type="image/png" href="https://theme-plume.vuejs.press/favicon-32x32.png"><title>数据库事务 | coder liang</title><meta name="description" content="事务的四大特性 事务是必须满足4个条件（ACID）：[A] 原子性 、[C] 一致性 、[I] 隔离性 、[D] 持久性 。 原子性：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。 一致性：在..."><link rel="preload" href="/assets/style-D8YYJzIE.css" as="style"><link rel="stylesheet" href="/assets/style-D8YYJzIE.css"><link rel="modulepreload" href="/assets/app-noM96vtB.js"><link rel="modulepreload" href="/assets/index.html-OqmSA4mN.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-e2a85a92><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0d85e7f4></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-0d85e7f4> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-e2a85a92 data-v-e2eaa4d4><div class="vp-navbar" vp-navbar data-v-e2eaa4d4 data-v-d72d6f9b><div class="wrapper" data-v-d72d6f9b><div class="container" data-v-d72d6f9b><div class="title" data-v-d72d6f9b><div class="vp-navbar-title has-sidebar" data-v-d72d6f9b data-v-205b69c8><a class="vp-link no-icon link title" href="/" data-v-205b69c8 data-v-8faef36c><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-f4386e50><!--]--><!--[--><img class="vp-image light logo" style="" src="https://theme-plume.vuejs.press/plume.png" alt data-v-f4386e50><!--]--><!--]--><!--]--><span data-v-205b69c8>coder liang</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-d72d6f9b><div class="content-body" data-v-d72d6f9b><!--[--><!--]--><div class="vp-navbar-search search" data-v-d72d6f9b><div class="search-wrapper" data-v-c59534bd><!----><div id="local-search" data-v-c59534bd><button type="button" class="mini-search mini-search-button" aria-label="搜索文档" data-v-c59534bd><span class="mini-search-button-container"><span class="mini-search-search-icon vpi-mini-search" aria-label="search icon"></span><span class="mini-search-button-placeholder">搜索文档</span></span><span class="mini-search-button-keys"><kbd class="mini-search-button-key"></kbd><kbd class="mini-search-button-key">K</kbd></span></button></div></div></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-d72d6f9b data-v-a16403a0><span id="main-nav-aria-label" class="visually-hidden" data-v-a16403a0>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-a16403a0 data-v-e9a2a996 data-v-8faef36c><!--[--><span class="vp-icon vpi-ntb045dk" style="" data-v-e9a2a996 data-v-741d51ad></span><span data-v-e9a2a996>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/knowledge/java/collection/" tabindex="0" data-v-a16403a0 data-v-e9a2a996 data-v-8faef36c><!--[--><span class="vp-icon vpi-77zwghws" style="" data-v-e9a2a996 data-v-741d51ad></span><span data-v-e9a2a996>练级</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/bookmark/" tabindex="0" data-v-a16403a0 data-v-e9a2a996 data-v-8faef36c><!--[--><span class="vp-icon vpi-sy904aeu" style="" data-v-e9a2a996 data-v-741d51ad></span><span data-v-e9a2a996>优秀文章收藏</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/notes/utils/log/" tabindex="0" data-v-a16403a0 data-v-e9a2a996 data-v-8faef36c><!--[--><span class="vp-icon vpi-ykea43yw" style="" data-v-e9a2a996 data-v-741d51ad></span><span data-v-e9a2a996>工具类备份</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/notes/storys/view/" tabindex="0" data-v-a16403a0 data-v-e9a2a996 data-v-8faef36c><!--[--><span class="vp-icon vpi-u1baiktf" style="" data-v-e9a2a996 data-v-741d51ad></span><span data-v-e9a2a996>故事会</span><!--]--><!----></a><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-d72d6f9b data-v-51d4779e><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-51d4779e data-v-ecae5613 data-v-58c1d8b1><span class="check" data-v-58c1d8b1><span class="icon" data-v-58c1d8b1><!--[--><span class="vpi-sun sun" data-v-ecae5613></span><span class="vpi-moon moon" data-v-ecae5613></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-d72d6f9b data-v-35aa5044 data-v-65bc2351><!--[--><a class="vp-social-link no-icon" href="/" aria-label="github" target="_blank" rel="noopener" data-v-65bc2351 data-v-04728ed0><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-d72d6f9b data-v-9fcd43db data-v-fdb558f8><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-fdb558f8><span class="vpi-more-horizontal icon" data-v-fdb558f8></span></button><div class="menu" data-v-fdb558f8><div class="vp-menu" data-v-fdb558f8 data-v-b3129113><!----><!--[--><!--[--><!----><div class="group" data-v-9fcd43db><div class="item appearance" data-v-9fcd43db><p class="label" data-v-9fcd43db>外观</p><div class="appearance-action" data-v-9fcd43db><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-9fcd43db data-v-ecae5613 data-v-58c1d8b1><span class="check" data-v-58c1d8b1><span class="icon" data-v-58c1d8b1><!--[--><span class="vpi-sun sun" data-v-ecae5613></span><span class="vpi-moon moon" data-v-ecae5613></span><!--]--></span></span></button></div></div></div><div class="group" data-v-9fcd43db><div class="item social-links" data-v-9fcd43db><div class="vp-social-links social-links-list" data-v-9fcd43db data-v-65bc2351><!--[--><a class="vp-social-link no-icon" href="/" aria-label="github" target="_blank" rel="noopener" data-v-65bc2351 data-v-04728ed0><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-d72d6f9b data-v-d5861cf2><span class="container" data-v-d5861cf2><span class="top" data-v-d5861cf2></span><span class="middle" data-v-d5861cf2></span><span class="bottom" data-v-d5861cf2></span></span></button></div></div></div></div><div class="divider" data-v-d72d6f9b><div class="divider-line" data-v-d72d6f9b></div></div></div><!----></header><div class="vp-local-nav reached-top" data-v-e2a85a92 data-v-d3ed9cc5><button class="menu" aria-expanded="false" aria-controls="SidebarNav" data-v-d3ed9cc5><span class="vpi-align-left menu-icon" data-v-d3ed9cc5></span><span class="menu-text" data-v-d3ed9cc5>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-d3ed9cc5 data-v-f17542da><button data-v-f17542da>返回顶部</button><!----></div></div><aside class="vp-sidebar" vp-sidebar data-v-e2a85a92 data-v-dbadda69><div class="curtain" data-v-dbadda69></div><nav id="SidebarNav" class="nav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-dbadda69><span id="sidebar-aria-label" class="visually-hidden" data-v-dbadda69> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-3e83e6e6><section class="vp-sidebar-item sidebar-item level-0" data-v-3e83e6e6 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-damdth4q bg" style="" data-v-584f9df0 data-v-741d51ad></span><h2 class="text" data-v-584f9df0>Java基础</h2><!----></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-rmfwztmd" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/java/collection/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Collection</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-nlfn5q0i" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/java/stream/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Stream</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-3e83e6e6><section class="vp-sidebar-item sidebar-item level-0" data-v-3e83e6e6 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-0d49agoq bg" style="" data-v-584f9df0 data-v-741d51ad></span><h2 class="text" data-v-584f9df0>常用框架</h2><!----></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-vtmd12lm" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/frame/spring/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Spring</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-ynd4u4np" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/frame/mybatisPlus/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Mybatis-Plus</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-tq12vsr8" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/frame/springRetry/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>SpringRetry</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-q5cd247g" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/frame/netty/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Netty</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-ofmclkfk" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/frame/redission/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Redisson</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-3e83e6e6><section class="vp-sidebar-item sidebar-item level-0" data-v-3e83e6e6 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-cpe6vezw bg" style="" data-v-584f9df0 data-v-741d51ad></span><h2 class="text" data-v-584f9df0>并发编程</h2><!----></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-jphjjoos" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/concurrent/thread/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Java 中的线程</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-hdv8rp4g" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/concurrent/thread-safe/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>线程安全</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-amwyu7b0" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/concurrent/lock/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Java 中的各种锁</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-7g2fx66j" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/concurrent/juc/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>JUC 并发编程</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-3e83e6e6><section class="vp-sidebar-item sidebar-item level-0 has-active" data-v-3e83e6e6 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-5tvhm0q4 bg" style="" data-v-584f9df0 data-v-741d51ad></span><h2 class="text" data-v-584f9df0>数据库</h2><!----></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-nx1hdjsn" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dbs/mysql/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>MySQL</p><!--]--><!----></a><!----></div><!----></div><section class="vp-sidebar-item sidebar-item level-1 collapsible collapsed" data-v-584f9df0 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-5xbu8jy4" style="" data-v-584f9df0 data-v-741d51ad></span><h3 class="text" data-v-584f9df0>Oracle</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-584f9df0><span class="vpi-chevron-right caret-icon" data-v-584f9df0></span></div></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-5xbu8jy4" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dbs/oracle/oracle/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>入门及概念</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-ine69j2x" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dbs/oracle/oracle-ddl/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>表操作语句</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-ine69j2x" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dbs/oracle/oracle-dql/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>查询语句及函数</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-ine69j2x" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dbs/oracle/oracle-plsql/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>sql编程</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-zu6zp6wf" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dbs/redis/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Redis</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-h9049z0o" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dbs/transcation/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>数据库事务</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-3e83e6e6><section class="vp-sidebar-item sidebar-item level-0" data-v-3e83e6e6 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-gificqz7 bg" style="" data-v-584f9df0 data-v-741d51ad></span><h2 class="text" data-v-584f9df0>开发组件</h2><!----></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-4qxaat9w" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/docker/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>Docker 容器</p><!--]--><!----></a><!----></div><!----></div><section class="vp-sidebar-item sidebar-item level-1 collapsible collapsed" data-v-584f9df0 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-4212a532" style="" data-v-584f9df0 data-v-741d51ad></span><h3 class="text" data-v-584f9df0>消息队列</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-584f9df0><span class="vpi-chevron-right caret-icon" data-v-584f9df0></span></div></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-4212a532" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/mq/mq/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>消息队列入门介绍</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-q9iwtfks" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/mq/mq-noLess/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>如何保证消息不丢失</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-5988odwo" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/mq/mq-noMore/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>如何处理重复消息</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-wre61vk1" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/mq/mq-order/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>如何保证消息有序</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-g8px4mge" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/mq/mq-backlog/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>消息积压怎么办</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-7tzcuzjd" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/mq/mq-diy/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>如何写个消息中间件</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><section class="vp-sidebar-item sidebar-item level-1 collapsible collapsed" data-v-584f9df0 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-bvoeucpl" style="" data-v-584f9df0 data-v-741d51ad></span><h3 class="text" data-v-584f9df0>分布式搜索</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-584f9df0><span class="vpi-chevron-right caret-icon" data-v-584f9df0></span></div></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-d4lg26iw" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/es/es/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>搜索入门介绍</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-3r279atw" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/es/es-install/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>安装 ElasticSearch</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-l2bnf96j" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/es/inverted-index/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>什么是倒排索引</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-2 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-i8hmy1lz" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/component/es/get-start/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>如何使用 ElasticSearch</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="no-transition group" data-v-3e83e6e6><section class="vp-sidebar-item sidebar-item level-0" data-v-3e83e6e6 data-v-584f9df0><div class="item" role="button" tabindex="0" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-kf3hmhp4 bg" style="" data-v-584f9df0 data-v-741d51ad></span><h2 class="text" data-v-584f9df0>数据结构</h2><!----></div><div class="items" data-v-584f9df0><!--[--><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-plhvdmz0" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dataStructure/array/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>array</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-t8tsumr2" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dataStructure/chain/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>chain</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-jzj1sanu" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dataStructure/stack/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>stack</p><!--]--><!----></a><!----></div><!----></div><div class="vp-sidebar-item sidebar-item level-1 is-link" data-v-584f9df0 data-v-584f9df0><div class="item" data-v-584f9df0><div class="indicator" data-v-584f9df0></div><span class="vp-icon vpi-olf6bx66" style="" data-v-584f9df0 data-v-741d51ad></span><a class="vp-link no-icon link link" href="/knowledge/dataStructure/tree/" data-v-584f9df0 data-v-8faef36c><!--[--><p class="text" data-v-584f9df0>tree</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><!--[--><div id="VPContent" vp-content class="vp-content has-sidebar" data-v-e2a85a92 data-v-f680e952><div class="vp-doc-container has-sidebar has-aside" data-v-f680e952 data-v-0c1b0d40><!--[--><!--]--><div class="container" data-v-0c1b0d40><div class="aside" vp-outline data-v-0c1b0d40><div class="aside-curtain" data-v-0c1b0d40></div><div class="aside-container" data-v-0c1b0d40><div class="aside-content" data-v-0c1b0d40><div class="vp-doc-aside" data-v-0c1b0d40 data-v-7f9316c5><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="vp-doc-aside-outline" role="navigation" data-v-7f9316c5 data-v-1deb207d><div class="content" data-v-1deb207d><div class="outline-marker" data-v-1deb207d></div><div id="doc-outline-aria-label" aria-level="2" class="outline-title" role="heading" data-v-1deb207d><span data-v-1deb207d>此页内容</span><span class="vpi-print icon" data-v-1deb207d></span></div><ul class="root" data-v-1deb207d data-v-6af2c33d><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-7f9316c5></div><!--[--><!--]--></div></div></div></div><div class="content" data-v-0c1b0d40><div class="content-container" data-v-0c1b0d40><!--[--><!--]--><main class="main" data-v-0c1b0d40><nav class="vp-breadcrumb" data-v-0c1b0d40 data-v-f0ee12f5><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-f0ee12f5><!--[--><li property="itemListElement" typeof="ListItem" data-v-f0ee12f5><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-f0ee12f5 data-v-8faef36c><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-f0ee12f5></span><meta property="name" content="首页" data-v-f0ee12f5><meta property="position" content="1" data-v-f0ee12f5></li><li property="itemListElement" typeof="ListItem" data-v-f0ee12f5><span class="vp-link no-icon breadcrumb" href="/" property="item" typeof="WebPage" data-v-f0ee12f5 data-v-8faef36c><!--[-->数据库<!--]--><!----></span><span class="vpi-chevron-right" data-v-f0ee12f5></span><meta property="name" content="数据库" data-v-f0ee12f5><meta property="position" content="2" data-v-f0ee12f5></li><li property="itemListElement" typeof="ListItem" data-v-f0ee12f5><a class="vp-link no-icon link breadcrumb current" href="/knowledge/dbs/transcation/" property="item" typeof="WebPage" data-v-f0ee12f5 data-v-8faef36c><!--[-->数据库事务<!--]--><!----></a><!----><meta property="name" content="数据库事务" data-v-f0ee12f5><meta property="position" content="3" data-v-f0ee12f5></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-48e8bd66>数据库事务 <!----></h1><div class="vp-doc-meta" data-v-48e8bd66><p class="reading-time" data-v-48e8bd66><span class="vpi-books icon" data-v-48e8bd66></span><span data-v-48e8bd66>约 1673 字</span><span data-v-48e8bd66>大约 6 分钟</span></p><!----><p class="create-time" data-v-48e8bd66><span class="vpi-clock icon" data-v-48e8bd66></span><span data-v-48e8bd66>2025-04-10</span></p></div><!--]--><div class="_knowledge_dbs_transcation_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-0c1b0d40><div data-v-0c1b0d40><h2 id="事务的四大特性" tabindex="-1"><a class="header-anchor" href="#事务的四大特性"><span>事务的四大特性</span></a></h2><p>事务是必须满足4个条件（ACID）：[A] 原子性 <span class="vp-annotation ignore-header Atomicity" aria-label="Atomicity" data-v-8b2972f1><span class="vpi-annotation" data-v-8b2972f1></span><!----></span> 、[C] 一致性 <span class="vp-annotation ignore-header Consistency" aria-label="Consistency" data-v-8b2972f1><span class="vpi-annotation" data-v-8b2972f1></span><!----></span> 、[I] 隔离性 <span class="vp-annotation ignore-header Isolation" aria-label="Isolation" data-v-8b2972f1><span class="vpi-annotation" data-v-8b2972f1></span><!----></span> 、[D] 持久性 <span class="vp-annotation ignore-header Durability" aria-label="Durability" data-v-8b2972f1><span class="vpi-annotation" data-v-8b2972f1></span><!----></span> 。</p><ul><li><p><strong>原子性</strong>：一个事务（<code>transaction</code>）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（<code>Rollback</code>）到事务开始前的状态，就像这个事务从来没有执行过一样。</p></li><li><p><strong>一致性</strong>：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。</p></li><li><p><strong>隔离性</strong>：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（<code>Read uncommitted</code>）、读提交（<code>read committed</code>）、可重复读（<code>repeatable read</code>）和串行化（<code>Serializable</code>）。</p></li><li><p><strong>持久性</strong>：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。</p></li></ul><h2 id="事务控制语句" tabindex="-1"><a class="header-anchor" href="#事务控制语句"><span>事务控制语句</span></a></h2><p>使用 <code>BEGIN</code> 或 <code>START TRANSACTION</code> 显式地开启一个事务</p><ul><li><p><code>COMMIT</code>: 用于提交事务，将所有的修改永久保存到数据库</p></li><li><p><code>ROLLBACK</code>: 用于回滚事务，撤销自上次提交以来所做的所有更改</p></li><li><p><code>SAVEPOINT</code>: 用于在事务中设置保存点，以便稍后能够回滚到该点</p></li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SAVEPOINT savepoint_name;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>ROLLBACK TO SAVEPOINT</code>: 把事务回滚到标记点</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ROLLBACK</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SAVEPOINT savepoint_name;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>MySQL 事务例子：</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 开始事务</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">START TRANSACTION</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 执行一些SQL语句</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">UPDATE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> accounts </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SET</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> balance </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> balance </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 100</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> user_id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">UPDATE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> accounts </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SET</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> balance </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> balance </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">+</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 100</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> user_id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 2</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 判断是否要提交还是回滚</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">IF</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (条件) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">THEN</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    COMMIT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 提交事务</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ELSE</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    ROLLBACK</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">; </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 回滚事务</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">END</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> IF</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="事务隔离级别" tabindex="-1"><a class="header-anchor" href="#事务隔离级别"><span>事务隔离级别</span></a></h2><table><thead><tr><th>隔离级别</th><th style="text-align:center;">脏读(Dirty Read)</th><th style="text-align:center;">不可重复读 (Non Repeatable Read)</th><th style="text-align:center;">幻读(Phantom Read)</th></tr></thead><tbody><tr><td>读未提交</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td></tr><tr><td>读提交</td><td style="text-align:center;">❌</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td></tr><tr><td>可重复读</td><td style="text-align:center;">❌</td><td style="text-align:center;">❌</td><td style="text-align:center;">✔️</td></tr><tr><td>串行化</td><td style="text-align:center;">❌</td><td style="text-align:center;">❌</td><td style="text-align:center;">❌</td></tr></tbody></table><div class="hint-container tip"><p class="hint-container-title">提示</p><p>在MySQL中，如果使用InnoDB，默认的隔离级别是Repeatable Read</p></div><p>➡️ <strong>Read Uncommitted</strong></p><p><code>Read Uncommitted</code> 是隔离级别最低的一种事务级别。在这种隔离级别下，<strong>一个事务会读到另一个事务更新后但未提交的数据，如果另一个事务回滚，那么当前事务读到的数据就是脏数据</strong>，这就是脏读（<code>Dirty Read</code>）</p><table><thead><tr><th style="text-align:center;">时刻</th><th style="text-align:center;">事务A</th><th style="text-align:center;">事务B</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td><td style="text-align:center;">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">BEGIN;</td><td style="text-align:center;">BEGIN;</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;">UPDATE students SET name = &#39;Bob&#39; WHERE id = 1;</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">4</td><td style="text-align:center;"></td><td style="text-align:center;">SELECT * FROM students WHERE id = 1;</td></tr><tr><td style="text-align:center;">5</td><td style="text-align:center;">ROLLBACK;</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">6</td><td style="text-align:center;"></td><td style="text-align:center;">SELECT * FROM students WHERE id = 1;</td></tr><tr><td style="text-align:center;">7</td><td style="text-align:center;"></td><td style="text-align:center;">COMMIT;</td></tr></tbody></table><p>当事务A执行完第3步时，它更新了id=1的记录，但并未提交，而事务B在第4步读取到的数据就是未提交的数据。</p><p>随后，事务A在第5步进行了回滚，事务B再次读取id=1的记录，发现和上一次读取到的数据不一致，这就是脏读。</p><p>➡️ <strong>Read Committed</strong></p><p>在<code>Read Committed</code>隔离级别下，一个事务不会读到另一个事务还没有提交的数据，但可能会遇到不可重复读（<code>Non Repeatable Read</code>）的问题。</p><p>不可重复读是指，<strong>在一个事务内，多次读同一数据，在这个事务还没有结束时，如果另一个事务恰好修改了这个数据，那么，在第一个事务中，两次读取的数据就可能不一致</strong>。</p><table><thead><tr><th style="text-align:center;">时刻</th><th style="text-align:center;">事务A</th><th style="text-align:center;">事务B</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td><td style="text-align:center;">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">BEGIN;</td><td style="text-align:center;">BEGIN;</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;"></td><td style="text-align:center;">SELECT * FROM students WHERE id = 1; -- Alice</td></tr><tr><td style="text-align:center;">4</td><td style="text-align:center;">UPDATE students SET name = &#39;Bob&#39; WHERE id = 1;</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">5</td><td style="text-align:center;">COMMIT;</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">6</td><td style="text-align:center;"></td><td style="text-align:center;">SELECT * FROM students WHERE id = 1;-- Bob</td></tr><tr><td style="text-align:center;">7</td><td style="text-align:center;"></td><td style="text-align:center;">COMMIT;</td></tr></tbody></table><p>当事务B第一次执行第3步的查询时，得到的结果是Alice，随后，由于事务A在第4步更新了这条记录并提交，</p><p>所以，事务B在第6步再次执行同样的查询时，得到的结果就变成了Bob，因此，在<code>Read Committed</code>隔离级别下，事务不可重复读同一条记录，因为很可能读到的结果不一致。</p><p>➡️ <strong>Repeatable Read</strong></p><p>在<code>Repeatable Read</code>隔离级别下，一个事务可能会遇到幻读（<code>Phantom Read</code>）的问题。</p><p>幻读是指，<strong>在一个事务中，第一次查询某条记录，发现没有，但是，当试图更新这条不存在的记录时，竟然能成功，并且，再次读取同一条记录，它就神奇地出现了</strong></p><table><thead><tr><th style="text-align:center;">时刻</th><th style="text-align:center;">事务A</th><th style="text-align:center;">事务B</th></tr></thead><tbody><tr><td style="text-align:center;">1</td><td style="text-align:center;">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td><td style="text-align:center;">SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</td></tr><tr><td style="text-align:center;">2</td><td style="text-align:center;">BEGIN;</td><td style="text-align:center;">BEGIN;</td></tr><tr><td style="text-align:center;">3</td><td style="text-align:center;"></td><td style="text-align:center;">SELECT * FROM students WHERE id = 99; -- empty</td></tr><tr><td style="text-align:center;">4</td><td style="text-align:center;">INSERT INTO students (id, name) VALUES (99, &#39;Bob&#39;);</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">5</td><td style="text-align:center;">COMMIT;</td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;">6</td><td style="text-align:center;"></td><td style="text-align:center;">SELECT * FROM students WHERE id = 99; -- empty</td></tr><tr><td style="text-align:center;">7</td><td style="text-align:center;"></td><td style="text-align:center;">UPDATE students SET name = &#39;Alice&#39; WHERE id = 99; -- 1 row affected</td></tr><tr><td style="text-align:center;">8</td><td style="text-align:center;"></td><td style="text-align:center;">SELECT * FROM students WHERE id = 99; -- Alice</td></tr><tr><td style="text-align:center;">9</td><td style="text-align:center;"></td><td style="text-align:center;">COMMIT;</td></tr></tbody></table><details class="hint-container details"><summary>看到这里纳闷了，怎么左边提交了 右边还是查不到</summary><p><strong>幻读的重点在于数据是否存在</strong>。原本不存在的数据却真实的存在了，这便是幻读。引起幻读的原因在于另一个事务进行了INSERT操作。</p><p>在可重复读隔离级别下，普通的查询是快照读，是不会看到别的事务插入的数据的。因此，幻读在 <strong>当前读</strong> 下才会出现。</p><p><strong>什么是快照读，什么是当前读？</strong></p><p>快照读读取的是<strong>快照数据</strong>。不加锁的简单的 SELECT都属于快照读，比如:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> player </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>当前读就是读取最新数据，而不是历史版本的数据</strong>。加锁的 SELECT，或者对数据进行增删改都会进行当前读。这有点像是 Java 中的 volatile 关键字，被 volatile 修饰的变量，进行修改时，JVM 会强制将其写回内存，而不是放在 CPU 缓存中，进行读取时，JVM 会强制从内存读取，而不是放在 CPU 缓存中。这样就能保证其可见行，保证每次读取到的都是最新的值。如果没有用 volatile 关键字修饰，变量的值可能会被放在 CPU 缓存中，这就导致读取到的值可能是某次修改的值，不能保证是最新的值。</p><p>如下的操作都会进行 当前读:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> player LOCK </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">IN</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SHARE MODE;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SELECT</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> *</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> player </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">FOR</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> UPDATE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">INSERT INTO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> player </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">values</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ...</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">DELETE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> FROM</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> player </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">WHERE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ...</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">UPDATE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> player </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SET</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-0c1b0d40 data-v-ed4033a5><!--[--><!--]--><!----><!----><nav class="prev-next" data-v-ed4033a5><div class="pager" data-v-ed4033a5><a class="vp-link no-icon link pager-link prev" href="/knowledge/dbs/redis/" data-v-ed4033a5 data-v-8faef36c><!--[--><span class="desc" data-v-ed4033a5>上一页</span><span class="title" data-v-ed4033a5>Redis</span><!--]--><!----></a></div><div class="pager" data-v-ed4033a5><a class="vp-link no-icon link pager-link next" href="/knowledge/component/docker/" data-v-ed4033a5 data-v-8faef36c><!--[--><span class="desc" data-v-ed4033a5>下一页</span><span class="title" data-v-ed4033a5>Docker 容器</span><!--]--><!----></a></div></nav></footer><!----><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-e2a85a92 data-v-f652afe6><span class="percent" data-allow-mismatch data-v-f652afe6>0%</span><span class="show icon vpi-back-to-top" data-v-f652afe6></span><svg aria-hidden="true" data-v-f652afe6><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-f652afe6></circle></svg></button><footer class="vp-footer has-sidebar" vp-footer data-v-e2a85a92 data-v-90f83487><!--[--><div class="container" data-v-90f83487><p class="message" data-v-90f83487>Power by <a target="_blank" href="https://v2.vuepress.vuejs.org/">VuePress</a> & <a target="_blank" href="https://theme-plume.vuejs.press">vuepress-theme-plume</a></p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-noM96vtB.js" defer></script></body></html>